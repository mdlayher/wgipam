image: archlinux
packages:
  - go
  - yamllint
sources:
  - https://github.com/mdlayher/wgipam
environment:
  GO111MODULE: "on"
tasks:
  - build: |
      go version
      go get golang.org/x/lint/golint
      go get honnef.co/go/tools/cmd/staticcheck
      cd wgipam/
      ./.cibuild.sh
      go vet ./...
      /home/build/go/bin/staticcheck ./...
      /home/build/go/bin/golint -set_exit_status . ./cmd/... ./internal/...
      go test -v -race ./...
      # Ensure a valid and sane YAML configuration can be generated.
      go build ./cmd/wgipamd/
      ./wgipamd -init
      yamllint ./wgipamd.yaml
